<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                template="#{pageContext.servletContext.contextPath}/resources/template/template.xhtml"
                xmlns:jsf="http://xmlns.jcp.org/jsf">
    <ui:define name="head">
        <script type="text/javascript">
            function popupConfirm(event) {
                var respuesta = confirm("¿Esta seguro de querer cargar estos archivos? Luego no se podrán eliminar");
                if (respuesta == false) {
                    $(".ui-fileupload-upload").removeClass("ui-state-disabled").removeAttr("aria-disabled").removeAttr("disabled");
                    event.xhr.abort();
                }
            }
        </script>
    </ui:define>
    <ui:define name="content">
        <h:form prependId="false">
            <div class="ui-g">
                <div class="card ui-g-12">
                    <h1>
                        <i class="fa fa-list-ol verde" style="font-size: 16px;"></i>
                        <p:spacer width="10"/>
                        <h:outputText value="Envio de boletas de pago"/>
                    </h1>

                    <p:messages id="messages" showDetail="true" closable="false" escape="false">
                        <p:autoUpdate />
                    </p:messages>

                    <h:panelGrid columns="2">
                        <p:outputLabel value="Seleccione un mes y año referente a la fecha de pago"/> 
                        <p:outputPanel>
                            <p:calendar pattern="MM_yyyy" value="#{boletaMB.fecha}" size="7">
                                <p:ajax event="dateSelect" listener="#{boletaMB.cargarArchivos()}" update="tblPendiente tblProcesado pngResumen updFile"/>
                            </p:calendar>
                            <p:spacer width="5"/>
                            <p:outputLabel value="NOTA: No importa el dia seleccionado" style="font-weight: bold;"/>
                        </p:outputPanel>
                    </h:panelGrid>
                    <br/>
                    <p:outputLabel value="Seleccione los archivos a procesar (Tamaño max. 20MB)"/>
                    <br/>
                    <p:fileUpload id="updFile" widgetVar="updFile" fileUploadListener="#{boletaMB.handleFileUpload}" mode="advanced" dragDropSupport="false"
                                  multiple="true" auto="false" disabled="#{boletaMB.deshabilitar}" allowTypes="/(\.|\/)(pdf)$/" 
                                  skinSimple="true" label="Seleccionar" uploadLabel="Cargar" cancelLabel="Cancelar" fileLimit="20000000" update="@this"/>
                    <br/>
                </div>
                <div class="ui-g-12 ui-lg-8">
                    <div class="card">
                        <h1>Archivos PENDIENTES</h1>
                        <p:dataTable id="tblPendiente" value="#{boletaMB.lstPendientes}" var="dato">
                            <p:column headerText="Archivo">
                                <p:outputLabel value="#{dato.nombreArchivo}"/>
                            </p:column>
                            <p:column headerText="Fecha subida" width="80" style="text-align: center;">
                                <p:outputLabel value="#{dato.fechaCreado}">
                                    <f:convertDateTime pattern="dd/MM/yyyy"/>
                                </p:outputLabel>
                            </p:column>
                            <p:column headerText="Num. Boletas" width="50" style="text-align: right;">
                                <p:outputLabel value="#{dato.numeroPaginas}">
                                    <f:convertNumber pattern="#,##0"/>
                                </p:outputLabel>
                            </p:column>
                        </p:dataTable>
                        <br/>
                        <h1>Archivos PROCESADOS</h1>
                        <p:dataTable id="tblProcesado" value="#{boletaMB.lstArchivoOriginales}" var="dato">
                            <p:column headerText="Archivo">
                                <p:outputLabel value="#{dato.nombreArchivo}"/>
                            </p:column>
                            <p:column headerText="Fecha subida" width="80" style="text-align: center;">
                                <p:outputLabel value="#{dato.fechaCreado}">
                                    <f:convertDateTime pattern="dd/MM/yyyy"/>
                                </p:outputLabel>
                            </p:column>
                            <p:column headerText="Num. Boletas" width="50" style="text-align: right;">
                                <p:outputLabel value="#{dato.numeroPaginas}">
                                    <f:convertNumber pattern="#,##0"/>
                                </p:outputLabel>
                            </p:column>
                        </p:dataTable>
                    </div>
                </div>


                <div class="ui-g-12  ui-lg-4">
                    <div class="card">
                        <h1>Resumen de las boletas procesas</h1>
                        <p:panelGrid columns="2" id="pngResumen" style="width: 100%; border:0px none; background-color:transparent;"
                                     columnClasses="col7, col5_label"
                                     styleClass="form-group ui-panelgrid-blank">
                            <p:outputLabel value="Fecha y hora de inicio: "/>
                            <p:outputLabel value="#{boletaMB.codigoGenerado.fechaInicio}">
                                <f:convertDateTime pattern="dd/MM/yyyy  -  HH:mm:ss"/>
                            </p:outputLabel>
                            <p:outputLabel value="Fecha y hora de fin: "/>
                            <p:outputLabel value="#{boletaMB.codigoGenerado.fechaFin}">
                                <f:convertDateTime pattern="dd/MM/yyyy  -  HH:mm:ss"/>
                            </p:outputLabel>
                            <p:outputLabel value="Número de docentes: "/>
                            <p:outputLabel value="#{boletaMB.codigoGenerado.enviado}" style="text-align: right;">
                                <f:convertNumber pattern="#,##0"/>
                            </p:outputLabel>
                            <p:outputLabel value="Correos no enviados: "/>
                            <p:outputPanel>
                                <p:commandLink value="Ver">
                                    <i class="fa fa-eye" aria-hidden="true"></i>
                                </p:commandLink>
                                <p:spacer width="10"/>
                                <p:outputLabel value="#{boletaMB.codigoGenerado.error}" style="text-align: right;">
                                    <f:convertNumber pattern="#,##0"/>
                                </p:outputLabel>
                            </p:outputPanel>
                            <p:outputLabel value="Docentes sin correo registrado: "/>
                            <p:outputPanel>
                                <p:commandLink value="ver">
                                    <i class="fa fa-eye" aria-hidden="true"></i>
                                </p:commandLink>
                                <p:spacer width="10"/>
                                <p:outputLabel value="#{boletaMB.codigoGenerado.sinCorreo}" style="text-align: right;">
                                    <f:convertNumber pattern="#,##0"/>
                                </p:outputLabel>
                            </p:outputPanel>
                        </p:panelGrid>
                    </div>
                </div>
            </div>
        </h:form>
    </ui:define>
</ui:composition>