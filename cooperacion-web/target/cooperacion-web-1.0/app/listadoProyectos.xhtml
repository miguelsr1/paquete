<ui:composition 
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:p="http://primefaces.org/ui"
    xmlns:f="http://java.sun.com/jsf/core"
    template="#{pageContext.servletContext.contextPath}/resources/template/plantilla.xhtml"
    xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:jsf="http://xmlns.jcp.org/jsf">

    <f:event listener="#{userBean.isCentroEscolar}" type="preRenderView" />

    <ui:define name="head">
        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDOZGfkDBXOJYiOY1ovS_alyW8YueD8hBg" type="text/javascript"></script>
        <h:outputScript name="js/nanoscroller.js" library="paradise-layout" />
        <h:outputScript name="js/layout.js" library="paradise-layout" />
        <h:outputScript name="calendar-localization.js" library="js"/>

        <style type="text/css">
            .label {
                width:20%;
                padding:4px;
            }
            .value {
                width:80%;
                padding:4px;
            }
            .grid {
                width:100%;
            }
            .error {
                color: red;
            }
            .outputLabel {
                font-weight: bold;
            }
            .grid {
                width:33%;
                padding:4px;
            }
            .ui-wizard-step-titles.ui-helper-reset.ui-helper-clearfix {
                height: 80px;
            }
        </style>
    </ui:define>

    <ui:define name="contenido">
        <p:messages id="messages" closable="true" escape="false" >
            <p:autoUpdate />
        </p:messages>

        <p:breadCrumb>
            <p:menuitem value="Inicio" url="inicio.mined" />
            <p:menuitem value="Listado de Proyectos" url="#" />
        </p:breadCrumb>
        <br/>

        <div class="p-grid crud-demo">
            <div class="p-col">
                <div class="card" style="display:#{!(userBean.centroEscolar)?'block':'none'}">
                    <h1>
                        <i class="fa fa-filter" style="font-size: 16px;"></i>
                        <p:spacer width="10" height="8"/>
                        <p:outputLabel value="Filtro de busqueda"/>
                    </h1>
                    <div class="products-buttonbar invoice-to">
                        <div jsf:id="divFiltros">
                            <div class="ui-fluid">
                                <div class="p-field p-grid">
                                    <p:outputLabel for="cboDepa" styleClass="p-col-12 p-mb-4 p-md-4 p-mb-md-0">Departamento</p:outputLabel>
                                    <div class="p-col-12 p-md-8">
                                        <p:selectOneMenu id="cboDepa" value="#{listadoView.codigoDepartamento}">
                                            <f:selectItem itemValue="null" itemLabel="Seleccione un valor"/>
                                            <f:selectItems value="#{ubicacionView.lstDepartamentos}" var="depa" itemValue="#{depa.codigoDepartamento}" itemLabel="#{depa.codigoDepartamento} - #{depa.nombreDepartamento}" />
                                            <p:ajax listener="#{listadoView.recuperarMunicipios}" update="cboMuni tblProyectos"/>
                                        </p:selectOneMenu>
                                    </div>
                                </div>
                                <div class="p-field p-grid">
                                    <p:outputLabel for="cboMuni" styleClass="p-col-12 p-mb-4 p-md-4 p-mb-md-0">Municipio</p:outputLabel>
                                    <div class="p-col-12 p-md-8">
                                        <p:selectOneMenu id="cboMuni" value="#{listadoView.idMunicipio}">
                                            <f:selectItem itemValue="null" itemLabel="Seleccione un valor"/>
                                            <f:selectItems value="#{listadoView.lstMunicipio}" var="mun" itemValue="#{mun.idMunicipio}" itemLabel="#{mun.codigoMunicipio} - #{mun.nombreMunicipio}"/>
                                            <p:ajax listener="#{listadoView.recuperarLstProyectos()}" update="tblProyectos" />
                                        </p:selectOneMenu>
                                    </div>
                                </div>
                                <div class="p-field p-grid">
                                    <p:outputLabel for="cboEstado" styleClass="p-col-12 p-mb-4 p-md-4 p-mb-md-0">Estado</p:outputLabel>
                                    <div class="p-col-12 p-md-8">
                                        <p:selectOneMenu id="cboEstado" value="#{listadoView.idEstado}">
                                            <f:selectItem itemValue="0" itemLabel="Seleccione un valor"/>
                                            <f:selectItem itemValue="1" itemLabel="DIGITADO"/>
                                            <f:selectItem itemValue="2" itemLabel="EN REVISIÓN"/>
                                            <f:selectItem itemValue="3" itemLabel="APROBADO"/>
                                            <p:ajax listener="#{listadoView.recuperarLstProyectos()}" update="tblProyectos" />
                                        </p:selectOneMenu>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="products-buttonbar">
                        <div style="width: 100%">
                            <p:panelGrid id="pnlFiltro" columns="2"
                                         style="width: 100%; border:0px none; background-color:transparent;"
                                         styleClass="form-group ui-panelgrid-blank">
                                <p:outputPanel>
                                    <h1>
                                        <i class="fa fa-list-ol" style="font-size: 16px;"></i>
                                        <p:spacer width="10"/>
                                        <p:outputLabel value="Listado"/>

                                    </h1>
                                </p:outputPanel>
                                <p:commandButton value="Ver" style="float: right" icon="pi pi-map-marker"
                                                 action="#{listadoView.agregarPuntos}"
                                                 styleClass="edit-button rounded-button success-button"
                                                 onclick="PF('dlgMap').show();" update="mapa" process="@this"/>
                            </p:panelGrid>
                        </div>
                    </div>
                    <div class="invoice-to">
                        <p:dataTable id="tblProyectos" value="#{listadoView.lstProyectos}" var="proyecto" reflow="true" styleClass="fixed-size">
                            <p:column headerText="Código C.E." width="50">
                                <h:outputText value="#{proyecto.codigoEntidad}"/>
                            </p:column>
                            <p:column headerText="Nombre C.E.">
                                <h:outputText value="#{proyecto.nombreCe}"/>
                            </p:column>
                            <p:column headerText="Ubicación">
                                <h:outputText value="#{proyecto.nombreMunicipio}, #{proyecto.nombreDepartamento}"/>
                            </p:column>
                            <p:column headerText="Nombre Director" rendered="false">
                                <h:outputText value="#{proyecto.nombreDirector}"/>
                            </p:column>
                            <p:column headerText="Correo Director" rendered="false">
                                <h:outputText value="#{proyecto.correoElectronico}"/>
                            </p:column>
                            <p:column headerText="Nombre Proyecto">
                                <h:outputText value="#{proyecto.nombreProyecto}"/>
                            </p:column>
                            <p:column headerText="Fecha Inicio" width="70">
                                <h:outputText value="#{proyecto.fechaInicio}">
                                    <f:convertDateTime pattern="dd/MM/yyyy"/>
                                </h:outputText>
                            </p:column>
                            <p:column headerText="Fecha Fin" width="70">
                                <h:outputText value="#{proyecto.fechaFin}">
                                    <f:convertDateTime pattern="dd/MM/yyyy"/>
                                </h:outputText>
                            </p:column>
                            <p:column headerText="Estado">
                                <h:outputText value="#{proyecto.idEstado eq 1 ? 'DIGITADO' : (proyecto.idEstado eq 2 ? 'EN REVISION': 'APROBADO')}"/>
                            </p:column>
                            <p:column width="50" >
                                <p:commandButton icon="pi pi-pencil" oncomplete="PF('manageProductDialog').show()" 
                                                 styleClass="edit-button rounded-button success-button" process="@this">
                                    <f:setPropertyActionListener value="#{proyecto}" target="#{listadoView.proyecto}" />
                                </p:commandButton>
                            </p:column>
                            <p:column headerText="Ver" rendered="display:#{!(userBean.centroEscolar)?'true':'false'}">
                                <p:commandButton icon="pi pi-eye" update="manage-product-content" 
                                                 action="#{listadoView.recuperarProyecto()}" oncomplete="PF('manageProductDialog').show()"
                                                 styleClass="edit-button rounded-button success-button" process="@this">
                                    <f:setPropertyActionListener value="#{proyecto.idProyecto}" target="#{listadoView.idProyecto}" />
                                </p:commandButton>
                            </p:column>
                        </p:dataTable>
                    </div>
                </div>
            </div>
        </div>


        <p:dialog header="Datos del Proyecto de Cooperación" width="900" showEffect="fade" modal="true" widgetVar="manageProductDialog" responsive="true">
            <p:outputPanel id="manage-product-content" class="ui-fluid">
                <div class="card">
                    <div class="ui-fluid ">
                        <div class="p-field p-grid">
                            <p:outputLabel value="Nombre del Proyecto:" styleClass="p-col-12 p-mb-3 p-md-3 p-mb-md-0"/>
                            <div class="p-col-12 p-md-9">
                                <p:outputLabel value="#{listadoView.proyecto.nombreProyecto}" />
                            </div>
                        </div>
                    </div>
                </div>
            </p:outputPanel>

            <f:facet name="footer">
                <p:commandButton value="Aceptar" icon="pi pi-check" onclick="PF('manageProductDialog').hide()" 
                                 class="primary-button" process="@this"/>
            </f:facet>
        </p:dialog> 

        <p:dialog id="dlgMap" widgetVar="dlgMap" header="Ubicación del Centro Educativo" width="800" height="550">
            <p:gmap id="mapa" center="#{listadoView.posicionInicial}" zoom="9" type="ROADMAP" style="width: 100%; height: 500px;" 
                    model="#{listadoView.simpleModel}" mapTypeControl="false" />

        </p:dialog>

        <h:outputStylesheet name="css/primeicons.css" library="paradise-layout" />
        <h:outputStylesheet name="css/primeflex.min.css" library="paradise-layout" />
        <h:outputStylesheet name="css/demo.css" library="demo" />
        <h:outputStylesheet name="css/nanoscroller.css" library="paradise-layout" />
    </ui:define>    
</ui:composition>
