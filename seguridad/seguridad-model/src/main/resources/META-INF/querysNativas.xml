<?xml version="1.0" encoding="UTF-8" ?>
<entity-mappings 
    xmlns="http://java.sun.com/xml/ns/persistence/orm" 
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://java.sun.com/xml/ns/persistence/orm  http://java.sun.com/xml/ns/persistence/orm_2_0.xsd"
    version="2.0">
    <description>Native queries para Paquete Escolar</description>
    
   
    <named-native-query name="Seguridad.OpcMenuNotInIdApp" 
                        result-class="sv.gob.mined.seguridad.model.dto.OpcionMenuDto">
        <query>
            <![CDATA[
            select 
                id_opc_menu                             as idOpcMenu,
                padre_id_opc_menu                       as padreIdOpcMenu, 
                nombre_opcion                           as nombreOpcion,
                sys_connect_by_path(nombre_opcion,'>>') as nombrePadre
            from 
                opcion_menu
            where id_opc_menu not in (select 
                                        gom.id_opc_menu 
                                    from 
                                        gru_opc_menu gom 
                                        inner join gru_app gap on gom.id_gru_app = gap.id_gru_app
                                    where 
                                        gap.id_aplicacion = ?1)
            start with id_opc_menu in (select id_opc_menu from opcion_menu where padre_id_opc_menu is null) 
            connect by prior 
                id_opc_menu = padre_id_opc_menu
            ]]>
        </query>
    </named-native-query>
    <named-native-query name="Seguridad.OpcMenuNotByIdAppAndIdMod" 
                        result-class="sv.gob.mined.seguridad.model.OpcionMenu">
        <query>
            <![CDATA[
                select 
                    opc.* 
                from modulo mod
                    inner join aplicacion app   on mod.id_aplicacion = app.id_aplicacion
                    inner join mod_opc_menu mom on mom.id_modulo = mod.id_modulo
                    inner join opcion_menu opc  on opc.id_opc_menu = mom.id_opc_menu
                where app.id_aplicacion = ?1 and
                    mod.id_modulo = ?2
                order by
                    opc.padre_id_opc_menu desc,
                    opc.orden
            ]]>
        </query>
    </named-native-query>
    
    <named-native-query name="Seguridad.isExisteOpcMenuToGruApp">
        <query>
            <![CDATA[
                select 
                    count(*)
                from 
                    gru_app gra
                    inner join gru_opc_menu gom on gra.id_gru_app = gom.id_gru_app 
                where 
                    gom.id_opc_menu = ?1 and
                    gra.id_gru_app = ?2
            ]]>
        </query>
    </named-native-query>
</entity-mappings>